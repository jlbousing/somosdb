<!Doctype html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
        
        
        <script src="https://www.gstatic.com/firebasejs/4.6.0/firebase.js"></script>
        <script src="https://www.gstatic.com/firebasejs/4.6.0/firebase-firestore.js"></script>
        <script src="js/init.js"></script>
        <link rel="stylesheet" href="css/syle.css">
    </head>
    
    <body>
    
    
    <table class="table table-sm-responsive table-md-responsive table-lg-responsive table-xl-responsive">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Apellido</th>
                                <th>Telefono</th>
                                <th>voto</th>
                            </tr>
                        </thead>
                        <tbody id="tableAmigo">
                        </tbody>
                    </table>
    
    <script window.onload = function(){
       db.collection("Amigo").get().then((querySnapshot) => {
                    
                            var i = 0;
                    
                              querySnapshot.forEach((documento) => {
                        
                                   var tr = document.createElement("tr");
                                   i += 1;
                                  
                                   document.getElementById("tableAmigo").appendChild(tr);
                                   /*
                                   var thId = document.createElement("th");
                                   thId.innerText = i.toString();
                                   tr.appendChild(thId);
                                   */
                                   var thNombre = document.createElement("th");
                                   thNombre.innerText = documento.data().nombre;
                                   tr.appendChild(thNombre);
            
                                   var thApellido = document.createElement("th");
                                   thApellido.innerText = documento.data().apellido;
                                   tr.appendChild(thApellido);
                                   
                                  /*
                                   var thCarrera = document.createElement("th");
                                   thCarrera.innerText = documento.data().carrera;
                                   tr.appendChild(thCarrera);
                                  */
                                  
                                   var thTlf = document.createElement("th");
                                   //thTlf.innerText = documento.data().telefono;
                                   var botontlf = document.createElement("button");
                                   botontlf.setAttribute("href","tel:"+documento.data().telefono);
                                   botontlf.className = "btn btn-success";
                                   botontlf.innerText = documento.data().telefono;
                                   botontlf.id = "tlf_"+i.toString(); //SE IDENTIFICA LA ETIQUETA
                                   //thTlf.id = "tlf_"+i.toString(); //SE IDENTIFICA LA ETIQUETA
                                   thTlf.appendChild(botontlf);
                                   tr.appendChild(thTlf);
            
                                   var thVoto = document.createElement("th");
                                   if(!documento.data().voto){
                                       //thVoto.innerText = "No";
                                       //var thBoton = document.createElement("th");
                                       //tr.appendChild(thBoton);
                                       var boton = document.createElement("button");
                                       boton.innerText = "No";
                                       boton.className = "btn btn-primary";
                                       boton.id = i.toString(); //SE GUARDA EL ID DEL CONTADOR
                                       
                                       //SE LE AGREGA UNA FUNCIÓN AL BOTON 
                                       boton.onclick = function(){
                                           var tlf = document.getElementById("tlf_"+boton.id).innerText;
                                           
                                           db.collection("Amigo").where("telefono","==",tlf).get()
                                           .then((querySnapshot) => {
                                               querySnapshot.forEach((doc) => {
                                                  
                                                   db.collection("Amigo").doc(doc.id).update({voto: true}).then(function(){
                                                       var textoNuevo = document.createElement("h5");
                                                       textoNuevo.innerText = "Votó";
                                                       textoNuevo.id = "newText";
                                                       
                                                       $("#"+boton.id).replaceWith("<h4>Votó</h4>");
                                                   });
                                                   
                                               });
                                           })
                                           
                                       }
                                       
                                       thVoto.appendChild(boton);
                                   }else{
                                       thVoto.innerText = "votó";
                                   }
                                   tr.appendChild(thVoto);
                    });
                    
                });
    }></script>
    
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
        <script src="js/main.js"></script>
    </body>
    </html>
